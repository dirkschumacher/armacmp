<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translate R Linear Algebra Code to Armadillo C++ • armacmp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Translate R Linear Algebra Code to Armadillo C++">
<meta property="og:description" content="Compile R code to Armadillo Cpp code.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">armacmp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/function-reference.html">Function reference</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dirkschumacher/armacmp">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="armacmp" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#armacmp" class="anchor"></a>armacmp</h1></div>
<!-- badges: start -->

<p>The goal of <code>armacmp</code> is to create a DSL to formulate linear algebra code in R that is compiled to C++ using the Armadillo Template Library.</p>
<p>The scope of the package is linear algebra and Armadillo. It is not meant to evolve into a general purpose R to C++ transpiler.</p>
<p>This is currently an <em>experimental prototype</em> with most certainly a lot of bugs and the appropriate code quality ;). However I would be happy for any type of feedback, alpha testers, feature requests and potential use cases.</p>
<p>Potential use cases:</p>
<ul>
<li>Speed up your code :)</li>
<li>Quickly estimate <code>Rcpp</code> speedup gain for linear algebra code</li>
<li>Learn how R linear algebra code can be expressed in C++ using <code>armacmp_compile</code> and use the code as a starting point for further development.</li>
<li>…</li>
</ul>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"dirkschumacher/armacmp"</span>)</a></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>You can compile R like code to C++. Not all R functions are supported.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(armacmp)</a></code></pre></div>
<p>Takes a matrix and returns its transpose.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">trans &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X))</a>
<a class="sourceLine" id="cb3-3" title="3">})</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">trans</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt; [1,]    1    2    3    4    5    6    7    8    9    10</span></a></code></pre></div>
</div>
<div id="api" class="section level2">
<h2 class="hasAnchor">
<a href="#api" class="anchor"></a>API</h2>
<p><code>armacmp</code> always compiles functions. Every function needs to have a <code>return</code> statement with an optional type argument.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">my_fun &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X, <span class="dt">y =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>())) {</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(X <span class="op">%*%</span><span class="st"> </span>y, <span class="dt">type =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>())</a>
<a class="sourceLine" id="cb4-3" title="3">}</a></code></pre></div>
<div id="inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#inputs" class="anchor"></a>Inputs</h3>
<p>You can define your inputs using the standard function syntax. By default paramters are of type <code>type_matrix</code>. But they can have other types such as:</p>
<ul>
<li>
<code>type_colvec</code> - a column vector</li>
<li>
<code>type_rowvec</code> - a row vector</li>
<li>
<code>type_scalar_integer</code> - a single int value</li>
<li>
<code>type_scalar_numeric</code> - a single double value</li>
</ul>
</div>
<div id="body" class="section level3">
<h3 class="hasAnchor">
<a href="#body" class="anchor"></a>Body</h3>
<ul>
<li>
<code>&lt;-</code> you can use assignments that cause a C++ copy. As most operations return armadillo expressions, this is often not a problem. Usually assignments create new matrix variables, unless all operands on the right hand side can be assumed to not be any matrix code. Then the C++11 compiler will figure out the concrete type.</li>
<li>
<code>=</code> use the equal assignment if you want to reassign a variable with a new value.</li>
</ul>
<p>Below is a list of functions that are currently supported:</p>
<p>… <em>TDD</em> For now, please take a look at the examples below.</p>
</div>
<div id="return" class="section level3">
<h3 class="hasAnchor">
<a href="#return" class="anchor"></a>Return</h3>
<p>All functions need to return a value using the <code>return</code> function.</p>
</div>
</div>
<div id="further-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#further-examples" class="anchor"></a>Further examples</h2>
<p>Equivalent to R’s crossprod (<code>t(x) %*% y</code>)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># by default arguments are assumed to be matrices</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># but you can also make it explicit</span></a>
<a class="sourceLine" id="cb5-3" title="3">crossprod2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(<span class="dt">X =</span> <span class="kw"><a href="reference/type_matrix.html">type_matrix</a></span>(), <span class="dt">Y =</span> <span class="kw"><a href="reference/type_matrix.html">type_matrix</a></span>()) {</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>Y)</a>
<a class="sourceLine" id="cb5-5" title="5">})</a>
<a class="sourceLine" id="cb5-6" title="6">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100000</span>)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw">crossprod2</span>(x, x), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/crossprod">crossprod</a></span>(x, x))</a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb5-9" title="9">microbenchmark<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(</a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="kw">crossprod2</span>(x, x),</a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/crossprod">crossprod</a></span>(x, x),</a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(x) <span class="op">%*%</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb5-13" title="13">)</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; Unit: microseconds</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt;              expr     min       lq     mean   median       uq      max</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt;  crossprod2(x, x) 376.252  998.912 1292.563 1034.706 1096.562 7488.349</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt;   crossprod(x, x) 524.362 1098.414 1331.424 1141.390 1223.968 6128.537</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt;        t(x) %*% x 865.109 1403.115 1848.332 1628.924 1686.014 8315.299</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt;  neval</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt;    100</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt;    100</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt;    100</span></a></code></pre></div>
<p>Compute the coefficient of a linear regression problem:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># by default X is assumed a matrix</span></a>
<a class="sourceLine" id="cb6-2" title="2">lm_fit &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X, <span class="dt">y =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/solve">solve</a></span>(X, y))</a>
<a class="sourceLine" id="cb6-4" title="4">})</a>
<a class="sourceLine" id="cb6-5" title="5">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(mpg <span class="op">~</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>cyl, <span class="dt">data =</span> mtcars)</a>
<a class="sourceLine" id="cb6-6" title="6">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(mtcars<span class="op">$</span>mpg)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/qr">qr.solve</a></span>(X, y)), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">lm_fit</span>(X, y)))</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>Or a C++ version of plogis:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">plogis2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(<span class="dt">x =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>x)))</a>
<a class="sourceLine" id="cb7-3" title="3">})</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">plogis2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)), stats<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Logistic">plogis</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>Or make predictions in a logistic regression model given the coefficients:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">log_predict &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(<span class="dt">coef =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>(), new_X) {</a>
<a class="sourceLine" id="cb8-2" title="2">  res &lt;-<span class="st"> </span>new_X <span class="op">%*%</span><span class="st"> </span>coef</a>
<a class="sourceLine" id="cb8-3" title="3">  score &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>res))</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(score, <span class="dt">type =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>())</a>
<a class="sourceLine" id="cb8-5" title="5">})</a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7">formula &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(mpg <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>cyl</a>
<a class="sourceLine" id="cb8-8" title="8">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix</a></span>(formula, <span class="dt">data =</span> mtcars)</a>
<a class="sourceLine" id="cb8-9" title="9">glm_fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(formula, <span class="dt">data =</span> mtcars, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">binomial</a></span>())</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(</a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">log_predict</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(glm_fit), X)),</a>
<a class="sourceLine" id="cb8-13" title="13">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(glm_fit, <span class="dt">newdata =</span> mtcars, <span class="dt">type =</span> <span class="st">"response"</span>))</a>
<a class="sourceLine" id="cb8-14" title="14">)</a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>Forward and backward solve are implemented</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">backsolve2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(x, <span class="dt">y =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/backsolve">backsolve</a></span>(x, y))</a>
<a class="sourceLine" id="cb9-3" title="3">})</a>
<a class="sourceLine" id="cb9-4" title="4">forwardsolve2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(x, <span class="dt">y =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/backsolve">forwardsolve</a></span>(x, y))</a>
<a class="sourceLine" id="cb9-6" title="6">})</a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co"># example from the docs of backsolve</span></a>
<a class="sourceLine" id="cb9-9" title="9">r &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(</a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb9-11" title="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb9-12" title="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-13" title="13">)</a>
<a class="sourceLine" id="cb9-14" title="14">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/backsolve">backsolve</a></span>(r, x), <span class="kw">backsolve2</span>(r, x))</a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/backsolve">forwardsolve</a></span>(r, x), <span class="kw">forwardsolve2</span>(r, x))</a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div id="for-loops" class="section level3">
<h3 class="hasAnchor">
<a href="#for-loops" class="anchor"></a>For loops</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">for_loop &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X, <span class="dt">offset =</span> <span class="kw"><a href="reference/type_scalar_numeric.html">type_scalar_numeric</a></span>()) {</a>
<a class="sourceLine" id="cb10-2" title="2">  X_new &lt;-<span class="st"> </span>X</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="co"># only seq_len is currently supported</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)) {</a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="co"># use = to update an existing variable</span></a>
<a class="sourceLine" id="cb10-6" title="6">    X_new =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X_new) <span class="op">%*%</span><span class="st"> </span>X_new <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span>offset)</a>
<a class="sourceLine" id="cb10-7" title="7">  }</a>
<a class="sourceLine" id="cb10-8" title="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(X_new)</a>
<a class="sourceLine" id="cb10-9" title="9">})</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11">for_loop_r &lt;-<span class="st"> </span><span class="cf">function</span>(X, offset) {</a>
<a class="sourceLine" id="cb10-12" title="12">  X_new &lt;-<span class="st"> </span>X</a>
<a class="sourceLine" id="cb10-13" title="13">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)) {</a>
<a class="sourceLine" id="cb10-14" title="14">    X_new &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X_new) <span class="op">%*%</span><span class="st"> </span>X_new <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span>offset)</a>
<a class="sourceLine" id="cb10-15" title="15">  }</a>
<a class="sourceLine" id="cb10-16" title="16">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(X_new)</a>
<a class="sourceLine" id="cb10-17" title="17">}</a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(</a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="kw">for_loop_r</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>), <span class="dt">ncol =</span> <span class="dv">10</span>), <span class="dt">offset =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb10-21" title="21">  <span class="kw">for_loop</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>), <span class="dt">ncol =</span> <span class="dv">10</span>), <span class="dt">offset =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb10-22" title="22">)</a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25">microbenchmark<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(</a>
<a class="sourceLine" id="cb10-26" title="26">  <span class="kw">for_loop_r</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dt">ncol =</span> <span class="dv">10</span>), <span class="dt">offset =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb10-27" title="27">  <span class="kw">for_loop</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dt">ncol =</span> <span class="dv">10</span>), <span class="dt">offset =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb10-28" title="28">)</a>
<a class="sourceLine" id="cb10-29" title="29"><span class="co">#&gt; Unit: microseconds</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="co">#&gt;                                                expr     min       lq</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="co">#&gt;  for_loop_r(matrix(1:1000, ncol = 10), offset = 10) 116.045 130.8865</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="co">#&gt;    for_loop(matrix(1:1000, ncol = 10), offset = 10)  37.505  38.9165</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="co">#&gt;       mean  median       uq     max neval</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="co">#&gt;  147.48018 134.354 141.4085 309.791   100</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="co">#&gt;   45.73006  39.959  41.5570 199.801   100</span></a></code></pre></div>
</div>
<div id="a-faster-cumprod" class="section level3">
<h3 class="hasAnchor">
<a href="#a-faster-cumprod" class="anchor"></a>A faster <code>cumprod</code>
</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">cumprod2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(<span class="dt">x =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cumsum">cumprod</a></span>(x))</a>
<a class="sourceLine" id="cb11-3" title="3">})</a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5">x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="dv">1</span><span class="op">:</span><span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb11-6" title="6">bench<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/bench/topics/mark">mark</a></span>(</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cumsum">cumprod</a></span>(x),</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">cumprod2</span>(x))</a>
<a class="sourceLine" id="cb11-9" title="9">)</a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt;   expression                   min   median `itr/sec` mem_alloc `gc/sec`</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt;   &lt;bch:expr&gt;              &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt; 1 cumprod(x)              119.44ms 125.13ms      8.09   15.26MB     5.39</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; 2 as.numeric(cumprod2(x))   3.97ms   4.32ms    220.      7.63MB    75.6</span></a></code></pre></div>
</div>
<div id="return-type" class="section level3">
<h3 class="hasAnchor">
<a href="#return-type" class="anchor"></a>Return type</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">return_type &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) {</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(X)), <span class="dt">type =</span> <span class="kw"><a href="reference/type_scalar_numeric.html">type_scalar_numeric</a></span>())</a>
<a class="sourceLine" id="cb12-3" title="3">})</a>
<a class="sourceLine" id="cb12-4" title="4">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dt">ncol =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb12-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">return_type</span>(X),</a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(X))</a>
<a class="sourceLine" id="cb12-8" title="8">)</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="kw">return_type</span>(X)</a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; [1] 5912.128</span></a></code></pre></div>
</div>
<div id="colsums-et-al-" class="section level3">
<h3 class="hasAnchor">
<a href="#colsums-et-al-" class="anchor"></a><code>colSums</code> et al.</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">colSums2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(X)), <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">#&gt; R function</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt; function (X) </span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; return(colSums(X))</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; C++ function translation</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt; arma::mat armacmp_fun(const arma::mat&amp; X)</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt; return arma::sum( X, 0 );</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb13-13" title="13">rowSums2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(X)))</a>
<a class="sourceLine" id="cb13-14" title="14">colMeans2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colMeans</a></span>(X)))</a>
<a class="sourceLine" id="cb13-15" title="15">rowMeans2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowMeans</a></span>(X)))</a>
<a class="sourceLine" id="cb13-16" title="16"></a>
<a class="sourceLine" id="cb13-17" title="17">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">ncol =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb13-18" title="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(X), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">colSums2</span>(X)))</a>
<a class="sourceLine" id="cb13-19" title="19"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(X), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">rowSums2</span>(X)))</a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colMeans</a></span>(X), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">colMeans2</span>(X)))</a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowMeans</a></span>(X), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">rowMeans2</span>(X)))</a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="just-compile-and-look-at-the-c-code" class="section level3">
<h3 class="hasAnchor">
<a href="#just-compile-and-look-at-the-c-code" class="anchor"></a>Just compile and look at the C++ code</h3>
<p>You can also take a look at the code itself, in case you would like to generate a C++ snippet that you can further extend.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="reference/armacmp_compile.html">armacmp_compile</a></span>(<span class="cf">function</span>(new_X, <span class="dt">coef =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb14-2" title="2">  res &lt;-<span class="st"> </span>new_X <span class="op">%*%</span><span class="st"> </span>coef</a>
<a class="sourceLine" id="cb14-3" title="3">  score &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>res))</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(score, <span class="dt">type =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>())</a>
<a class="sourceLine" id="cb14-5" title="5">}, <span class="st">"log_predict"</span>)</a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co">#&gt; R function</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">#&gt; function (new_X, coef = type_colvec()) </span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">#&gt;     res &lt;- new_X %*% coef</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">#&gt;     score &lt;- 1/(1 + exp(-res))</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co">#&gt;     return(score, type = type_colvec())</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="co">#&gt; C++ function translation</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="co">#&gt; arma::colvec log_predict(const arma::mat&amp; new_X, const arma::colvec&amp; coef)</span></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb14-19" title="19"><span class="co">#&gt; arma::mat res = new_X * coef;</span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="co">#&gt; arma::mat score = 1 / ( 1 + arma::exp( -res ) );</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="co">#&gt; return score;</span></a>
<a class="sourceLine" id="cb14-22" title="22"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb14-23" title="23"><span class="co">#&gt; </span></a></code></pre></div>
</div>
<div id="if-clause" class="section level3">
<h3 class="hasAnchor">
<a href="#if-clause" class="anchor"></a>If clause</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">if_clause &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X) {</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="co"># infers that test needs to be bool (auto)</span></a>
<a class="sourceLine" id="cb15-3" title="3">  test &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(X)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="cf">if</span> (test) {</a>
<a class="sourceLine" id="cb15-5" title="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X) <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb15-6" title="6">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(X) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X)</a>
<a class="sourceLine" id="cb15-8" title="8">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb15-9" title="9">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X) <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb15-10" title="10">  }</a>
<a class="sourceLine" id="cb15-11" title="11">})</a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13">if_clause_r &lt;-<span class="st"> </span><span class="cf">function</span>(X) {</a>
<a class="sourceLine" id="cb15-14" title="14">  test &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(X)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb15-15" title="15">  <span class="cf">if</span> (test) {</a>
<a class="sourceLine" id="cb15-16" title="16">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X) <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb15-17" title="17">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(X) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb15-18" title="18">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X)</a>
<a class="sourceLine" id="cb15-19" title="19">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb15-20" title="20">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(X) <span class="op">%*%</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb15-21" title="21">  }</a>
<a class="sourceLine" id="cb15-22" title="22">}</a>
<a class="sourceLine" id="cb15-23" title="23"></a>
<a class="sourceLine" id="cb15-24" title="24">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb15-25" title="25"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(</a>
<a class="sourceLine" id="cb15-26" title="26">  <span class="kw">if_clause_r</span>(X),</a>
<a class="sourceLine" id="cb15-27" title="27">  <span class="kw">if_clause</span>(X)</a>
<a class="sourceLine" id="cb15-28" title="28">)</a>
<a class="sourceLine" id="cb15-29" title="29"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb15-30" title="30"></a>
<a class="sourceLine" id="cb15-31" title="31">microbenchmark<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(</a>
<a class="sourceLine" id="cb15-32" title="32">  <span class="kw">if_clause_r</span>(X),</a>
<a class="sourceLine" id="cb15-33" title="33">  <span class="kw">if_clause</span>(X)</a>
<a class="sourceLine" id="cb15-34" title="34">)</a>
<a class="sourceLine" id="cb15-35" title="35"><span class="co">#&gt; Unit: microseconds</span></a>
<a class="sourceLine" id="cb15-36" title="36"><span class="co">#&gt;            expr     min      lq     mean   median       uq      max neval</span></a>
<a class="sourceLine" id="cb15-37" title="37"><span class="co">#&gt;  if_clause_r(X) 289.947 306.924 390.6255 312.5045 326.4630 6119.187   100</span></a>
<a class="sourceLine" id="cb15-38" title="38"><span class="co">#&gt;    if_clause(X) 105.834 132.928 143.9505 135.6570 142.3765  249.203   100</span></a></code></pre></div>
</div>
<div id="qr-decomposition" class="section level3">
<h3 class="hasAnchor">
<a href="#qr-decomposition" class="anchor"></a>QR decomposition</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">lm_cpp &lt;-<span class="st"> </span><span class="kw"><a href="reference/armacmp.html">armacmp</a></span>(<span class="cf">function</span>(X, <span class="dt">y =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>()) {</a>
<a class="sourceLine" id="cb16-2" title="2">  qr_res &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/qr">qr</a></span>(X)</a>
<a class="sourceLine" id="cb16-3" title="3">  qty &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/qraux">qr.Q</a></span>(qr_res)) <span class="op">%*%</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb16-4" title="4">  beta_hat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/backsolve">backsolve</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/qraux">qr.R</a></span>(qr_res), qty)</a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(beta_hat, <span class="dt">type =</span> <span class="kw"><a href="reference/type_colvec.html">type_colvec</a></span>())</a>
<a class="sourceLine" id="cb16-6" title="6">})</a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co"># example from the R docs of lm.fit</span></a>
<a class="sourceLine" id="cb16-9" title="9">n &lt;-<span class="st"> </span><span class="dv">70000</span> ; p &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb16-10" title="10">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n <span class="op">*</span><span class="st"> </span>p), n, p) </a>
<a class="sourceLine" id="cb16-11" title="11">y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n)</a>
<a class="sourceLine" id="cb16-12" title="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all.equal">all.equal</a></span>(</a>
<a class="sourceLine" id="cb16-13" title="13">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lmfit">lm.fit</a></span>(X, y))),</a>
<a class="sourceLine" id="cb16-14" title="14">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw">lm_cpp</span>(X, y))</a>
<a class="sourceLine" id="cb16-15" title="15">)</a>
<a class="sourceLine" id="cb16-16" title="16"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="related-projects" class="section level3">
<h3 class="hasAnchor">
<a href="#related-projects" class="anchor"></a>Related projects</h3>
<ul>
<li>
<a href="https://github.com/nimble-dev/nCompiler">nCompiler</a> - Code-generate C++ from R. Inspired the approach to compile R functions directly.</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/dirkschumacher/armacmp">https://​github.com/​dirkschumacher/​armacmp</a>
</li>
<li>Report a bug at <br><a href="https://github.com/dirkschumacher/armacmp/issues">https://​github.com/​dirkschumacher/​armacmp/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dirk Schumacher <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://travis-ci.org/dirkschumacher/armacmp"><img src="https://travis-ci.org/dirkschumacher/armacmp.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/dirkschumacher/armacmp?branch=master"><img src="https://codecov.io/gh/dirkschumacher/armacmp/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dirk Schumacher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
